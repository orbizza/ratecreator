datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL_ONLINE")
}

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x", "linux-arm64-openssl-1.1.x"]
}

model Category {
  id           String     @id @default(auto()) @map("_id") @db.ObjectId 
  name         String   
  slug         String @unique
  shortDescription  String?
  longDescription String?
  keywords      String[]
  parentId     String? @db.ObjectId
  parent       Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  subcategories Category[] @relation("CategoryHierarchy")
  accounts     CategoryMapping[] @relation("CategoryToCategoryMapping") // Added @relation attribute
  popular      Boolean    @default(false)
  depth        Int        @default(0)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  deletedAt    DateTime?
 
  @@index([name])
  @@index([parentId])
  @@index([shortDescription])
  @@index([longDescription])
  @@index([keywords])
  @@index([popular])
}



model Account {
  id              String     @id @default(auto()) @map("_id") @db.ObjectId
  platform        Platform
  accountId       String
  handle          String?
  name            String?
  name_en         String?
  followerCount   Int?
  imageUrl        String?
  country         String?   
  description     String?
  description_en  String?
  keywords        String?
  keywords_en     String?
  categories      CategoryMapping[] @relation("AccountToCategoryMapping") 
  ytData          Json?
  redditData      Json?
  xData           Json?
  tiktokData      Json?
  twitchData      Json?
  instagramData   Json?
  isSeeded        Boolean    @default(false)
  isSuspended     Boolean    @default(false)
  ranking         Json?
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  language_code   String?
  lang_confidence_score Float?
  rating          Float?
  reviewCount     Int?
  isSubCategoryFailed Boolean? @default(false)
  lastIndexedAt   DateTime?
  isDeleted       Boolean? @default(false)
  isCategoryFailed Boolean? @default(false)
  isTranslationFailed Boolean? @default(false)
  
  @@unique([platform, accountId])
  @@index([platform])
  @@index([accountId])
  @@index([handle])
  @@index([name])
  @@index([name_en])
  @@index([country])
  @@index([followerCount])
  @@index([description])
  @@index([keywords])
  @@index([description_en])
  @@index([keywords_en])
  @@index([isSuspended])
  @@index([language_code])
  @@index([reviewCount])
  @@index([rating])
  @@index([isSubCategoryFailed])
  @@index([lastIndexedAt])
  @@index([isDeleted])
  @@index([isCategoryFailed])
  @@index([isTranslationFailed])
  @@index([isSeeded])
}



model CategoryMapping {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  accountId  String   @db.ObjectId
  categoryId String   @db.ObjectId
  account    Account  @relation("AccountToCategoryMapping", fields: [accountId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  category   Category @relation("CategoryToCategoryMapping", fields: [categoryId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([accountId, categoryId])
  @@index([accountId])
  @@index([categoryId])
}


enum Platform {
  YOUTUBE
  TWITTER
  INSTAGRAM
  REDDIT
  TIKTOK
  TWITCH
}

model User {
  id              String    @id @default(auto()) @map("_id") @db.ObjectId // MongoDB's default ObjectId 
  clerkId         String    @unique
  email           String    @unique
  name            String?
  username        String?
  isDeleted       Boolean   @default(false) // Soft delete indicator
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  deletedAt       DateTime?
  webhookPayload  Json?
  role            UserRole[]  @default([USER])

  @@index([name])
  @@index([username])
  @@index([isDeleted])
  @@index([role])
}

enum UserRole {
  USER
  ADMIN
  CREATOR
  BRAND
}



