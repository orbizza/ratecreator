datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Category {
  id           String     @id @default(cuid()) @map("_id")
  name         String   
  description  String?
  parentId     String?
  parent       Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  subcategories Category[] @relation("CategoryHierarchy")
  accounts     CategoryMapping[]
  depth        Int        @default(0)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  deletedAt    DateTime?

  @@unique([name, parentId])
  @@index([name])
  @@index([parentId])
  @@index([description])
}


model Account {
  id              String     @id @default(cuid()) @map("_id")
  platform        Platform
  accountId       String
  handle          String?
  name            String?
  followerCount   Int?
  imageUrl        String?
  categories      CategoryMapping[]
  details         Json?
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

  @@unique([platform, accountId])
  @@index([platform])
  @@index([accountId])
  @@index([handle])
  @@index([followerCount])
}

model CategoryMapping {
  id         String   @id @default(cuid()) @map("_id")
  accountId  String
  categoryId String
  account    Account  @relation(fields: [accountId], references: [id])
  category   Category @relation(fields: [categoryId], references: [id])
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([accountId, categoryId])
  @@index([accountId])
  @@index([categoryId])
}

enum Platform {
  YOUTUBE
  TWITTER
  INSTAGRAM
  REDDIT
  TIKTOK
  TWITCH
}

