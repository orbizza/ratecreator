datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL_ONLINE")
}

generator client {
  provider = "prisma-client-js"
}

model Category {
  id           String     @id @default(cuid()) @map("_id")
  name         String   
  slug         String
  shortDescription  String?
  longDescription String?
  keywords      String[]
  parentId     String?
  parent       Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  subcategories Category[] @relation("CategoryHierarchy")
  accounts     CategoryMapping[] @relation("CategoryToCategoryMapping") // Added @relation attribute
  popular      Boolean    @default(false)
  depth        Int        @default(0)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  deletedAt    DateTime?

  @@unique([slug])
  @@index([name])
  @@index([parentId])
  @@index([shortDescription])
  @@index([longDescription])
  @@index([keywords])
  @@index([popular])
}



model Account {
  id              String     @id @default(cuid()) @map("_id")
  platform        Platform
  accountId       String
  handle          String?
  name            String?
  name_en         String?
  followerCount   Int?
  imageUrl        String?
  country         String?   
  description     String?
  description_en  String?
  keywords        String?
  keywords_en     String?
  categories      CategoryMapping[] @relation("AccountToCategoryMapping") 
  ytData          Json?
  isSeeded        Boolean    @default(false)
  isSuspended     Boolean    @default(false)
  ranking         Json?
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  language_code   String?
  lang_confidence_score Float?
  rating          Float?
  reviewCount     Int?
  isSubCategoryFailed Boolean? @default(false)
  lastIndexedAt   DateTime?
  
  @@unique([platform, accountId])
  @@index([platform])
  @@index([accountId])
  @@index([handle])
  @@index([name])
  @@index([name_en])
  @@index([country])
  @@index([followerCount])
  @@index([description])
  @@index([keywords])
  @@index([description_en])
  @@index([keywords_en])
  @@index([isSuspended])
  @@index([language_code])
  @@index([reviewCount])
  @@index([rating])
  @@index([isSubCategoryFailed])
  @@index([lastIndexedAt])
}


model CategoryMapping {
  id         String   @id @default(cuid()) @map("_id")
  accountId  String
  categoryId String
  account    Account  @relation("AccountToCategoryMapping", fields: [accountId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  category   Category @relation("CategoryToCategoryMapping", fields: [categoryId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([accountId, categoryId])
  @@index([accountId])
  @@index([categoryId])
}


enum Platform {
  YOUTUBE
  TWITTER
  INSTAGRAM
  REDDIT
  TIKTOK
  TWITCH
}

